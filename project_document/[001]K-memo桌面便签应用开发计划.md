# K-memo桌面便签应用开发计划

**项目编号：** [001]
**创建时间：** 2025-01-15
**更新时间：** 2025-09-17
**项目路径：** E:\Code\project\K-memo\k-memo
**技术栈：** Qt6 + CMake + C++17 + SQLite
**选定方案：** 方案二（平衡方案）
**当前状态：** 🚀 执行阶段 - 基础架构搭建中
**完成进度：** 阶段一任务1.1已完成 ✅

## 项目概述

### 核心功能需求（已确认）
1. 待办事项列表管理（增删查改）
2. 任务分类和标签系统
3. 任务优先级设置
4. Windows 11消息提醒功能
5. 快捷键支持
6. 最小化到系统托盘

### 已移除功能
- ~~任务搜索和过滤功能~~（用户确认移除）
- ~~主题和界面自定义~~（用户确认移除）

### 技术架构
- **架构模式：** MVC
- **数据存储：** SQLite本地数据库
- **UI框架：** Qt6 Widgets
- **构建系统：** CMake
- **目标平台：** Windows 11

## 分阶段开发计划

### 第一阶段：核心功能实现（预计1周）

#### 任务1.1：数据模型设计与实现
**状态：** [ ] 未开始  
**预计时间：** 1天  
**详细内容：**
- 设计Task实体类（id, title, description, createTime, dueTime, priority, status, category, tags, reminder）
- 实现TaskPriority和TaskStatus枚举
- 创建Task类的序列化/反序列化方法
- 编写Task类的验证逻辑

#### 任务1.2：SQLite数据库设计与实现
**状态：** [ ] 未开始  
**预计时间：** 1天  
**详细内容：**
- 设计数据库表结构（tasks表、task_tags表）
- 实现DatabaseManager类
- 实现基础CRUD操作（创建、读取、更新、删除任务）
- 添加数据库版本管理和迁移机制
- 编写数据库操作的单元测试

#### 任务1.3：任务数据模型集成
**状态：** [ ] 未开始  
**预计时间：** 1天  
**详细内容：**
- 创建TaskModel类（继承QAbstractListModel）
- 实现模型的数据接口（rowCount, data, setData等）
- 集成DatabaseManager到TaskModel
- 实现任务的增删改查操作
- 添加数据变更信号

#### 任务1.4：基础UI界面设计
**状态：** [ ] 未开始  
**预计时间：** 1.5天  
**详细内容：**
- 重新设计kmemo.ui主界面布局
- 创建任务列表视图（QListView + 自定义委托）
- 实现TaskItemWidget自定义任务项显示
- 创建基础的菜单栏和工具栏
- 添加状态栏显示任务统计信息

#### 任务1.5：任务编辑功能实现
**状态：** [ ] 未开始  
**预计时间：** 1.5天  
**详细内容：**
- 创建TaskEditDialog任务编辑对话框
- 实现任务标题、描述、截止时间编辑
- 添加任务优先级选择控件
- 实现任务状态切换功能
- 连接UI与数据模型，实现数据绑定

### 第二阶段：增强功能实现（预计1周）

#### 任务2.1：分类系统实现
**状态：** [ ] 未开始  
**预计时间：** 1.5天  
**详细内容：**
- 扩展数据库支持任务分类
- 创建CategoryTreeWidget分类树控件
- 实现分类的增删改功能
- 添加分类过滤功能
- 实现默认分类和自定义分类

#### 任务2.2：标签系统实现
**状态：** [ ] 未开始  
**预计时间：** 1.5天  
**详细内容：**
- 实现task_tags表的完整操作
- 创建TagWidget标签输入控件
- 实现标签的自动完成功能
- 添加标签云显示和过滤
- 支持多标签选择和管理

#### 任务2.3：搜索和过滤功能
**状态：** [ ] 未开始  
**预计时间：** 2天  
**详细内容：**
- 创建SearchFilterWidget搜索控件
- 实现任务标题和内容的全文搜索
- 添加按优先级、状态、分类的过滤
- 实现按时间范围的过滤功能
- 支持复合条件搜索

#### 任务2.4：优先级和状态管理优化
**状态：** [ ] 未开始  
**预计时间：** 1天  
**详细内容：**
- 优化优先级显示（颜色、图标）
- 实现任务状态的快速切换
- 添加批量操作功能
- 优化任务列表的排序功能

### 第三阶段：系统集成功能（预计1周）

#### 任务3.1：系统托盘功能实现
**状态：** [ ] 未开始  
**预计时间：** 1.5天  
**详细内容：**
- 创建TrayManager系统托盘管理器
- 实现托盘图标和右键菜单
- 添加托盘图标显示未完成任务数量
- 实现双击托盘显示/隐藏主窗口
- 支持最小化到托盘功能

#### 任务3.2：Windows 11通知系统
**状态：** [ ] 未开始  
**预计时间：** 2天  
**详细内容：**
- 创建NotificationManager通知管理器
- 实现基于QSystemTrayIcon的通知
- 添加任务到期提醒功能
- 实现可配置的提醒时间
- 支持重复提醒和通知历史

#### 任务3.3：快捷键系统实现
**状态：** [ ] 未开始  
**预计时间：** 1天  
**详细内容：**
- 实现全局快捷键（显示/隐藏窗口）
- 添加应用内快捷键（新建、删除、搜索等）
- 创建快捷键配置界面
- 支持自定义快捷键设置

#### 任务3.4：主题和配置系统
**状态：** [ ] 未开始  
**预计时间：** 1.5天  
**详细内容：**
- 创建ThemeManager主题管理器
- 实现明亮/暗黑主题切换
- 创建ConfigManager配置管理器
- 实现设置界面（SettingsDialog）
- 支持窗口位置、大小等配置保存

#### 任务3.5：项目完善和测试
**状态：** [ ] 未开始  
**预计时间：** 1天  
**详细内容：**
- 完善CMakeLists.txt配置
- 添加必要的Qt模块依赖
- 进行功能测试和bug修复
- 优化性能和用户体验
- 编写用户使用文档

## 技术要点

### 关键依赖
```cmake
find_package(Qt6 REQUIRED COMPONENTS 
    Widgets 
    Sql 
    Network
)
```

### 核心类设计
- **Task**: 任务实体类
- **TaskModel**: 任务数据模型
- **DatabaseManager**: 数据库管理
- **NotificationManager**: 通知管理
- **TrayManager**: 系统托盘管理
- **ThemeManager**: 主题管理
- **ConfigManager**: 配置管理

### 数据库表结构
```sql
-- 任务表
CREATE TABLE tasks (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    title TEXT NOT NULL,
    description TEXT,
    create_time DATETIME DEFAULT CURRENT_TIMESTAMP,
    due_time DATETIME,
    priority INTEGER DEFAULT 1,
    status INTEGER DEFAULT 0,
    category TEXT,
    reminder_enabled BOOLEAN DEFAULT 0,
    reminder_minutes INTEGER DEFAULT 15
);

-- 标签关联表
CREATE TABLE task_tags (
    task_id INTEGER,
    tag TEXT,
    FOREIGN KEY(task_id) REFERENCES tasks(id)
);
```

## 风险评估与应对

### 技术风险
1. **Windows 11通知集成** - 中等风险
   - 应对：优先使用QSystemTrayIcon，后期可扩展Windows Toast API
   
2. **全局快捷键实现** - 中等风险
   - 应对：使用Qt的QShortcut，必要时集成Windows API
   
3. **数据库性能** - 低风险
   - 应对：合理设计索引，实现分页加载

### 进度风险
1. **功能复杂度超预期** - 低风险
   - 应对：严格按阶段交付，优先保证核心功能

## 验收标准

### 第一阶段验收
- [ ] 能够创建、编辑、删除任务
- [ ] 任务数据能够持久化存储
- [ ] 基础UI界面完整可用

### 第二阶段验收
- [ ] 分类和标签功能正常工作
- [ ] 搜索过滤功能准确有效
- [ ] 优先级显示和排序正确

### 第三阶段验收
- [ ] 系统托盘功能完整
- [ ] 通知提醒准时有效
- [ ] 快捷键响应正常
- [ ] 主题切换流畅

## 后续扩展计划

1. **服务器集成阶段**
   - 用户注册登录系统
   - 云端数据同步
   - 多设备数据共享

2. **高级功能阶段**
   - 任务模板功能
   - 数据分析报表
   - 团队协作功能

---

**计划制定完成时间：** 2025-01-15  
**计划执行开始时间：** 待确认  
**预计项目完成时间：** 3周后
