# K-memo Qtæ—¥å¿—ç³»ç»Ÿå¼€å‘æ–‡æ¡£

**é¡¹ç›®ç¼–å·ï¼š** [303]  
**æ–‡æ¡£ç±»å‹ï¼š** æŠ€æœ¯ä¸“é¢˜æ–‡æ¡£  
**åˆ›å»ºæ—¶é—´ï¼š** 2025-10-25  
**é€‚ç”¨ç‰ˆæœ¬ï¼š** K-memo v1.0+  
**æŠ€æœ¯æ ˆï¼š** Qt6 Coreæ—¥å¿—ç³»ç»Ÿ + è‡ªå®šä¹‰LogManager  

---

## ğŸ“‘ ç›®å½•

- [ä¸€ã€æ¦‚è¿°](#ä¸€æ¦‚è¿°)
- [äºŒã€è®¾è®¡æ–¹æ¡ˆ](#äºŒè®¾è®¡æ–¹æ¡ˆ)
- [ä¸‰ã€LogManagerå®ç°](#ä¸‰logmanagerå®ç°)
- [å››ã€ä½¿ç”¨æŒ‡å—](#å››ä½¿ç”¨æŒ‡å—)
- [äº”ã€é…ç½®è¯´æ˜](#äº”é…ç½®è¯´æ˜)
- [å…­ã€æœ€ä½³å®è·µ](#å…­æœ€ä½³å®è·µ)
- [ä¸ƒã€æ€§èƒ½è€ƒè™‘](#ä¸ƒæ€§èƒ½è€ƒè™‘)
- [å…«ã€æ•…éšœæ’æŸ¥](#å…«æ•…éšœæ’æŸ¥)

---

## ä¸€ã€æ¦‚è¿°

### 1.1 ä¸ºä»€ä¹ˆéœ€è¦æ—¥å¿—ç³»ç»Ÿï¼Ÿ

**æ—¥å¿—ç³»ç»Ÿçš„ä»·å€¼ï¼š**
- ğŸ› **è°ƒè¯•è¾…åŠ©** - å¿«é€Ÿå®šä½é—®é¢˜æ ¹æº
- ğŸ“Š **è¿è¡Œç›‘æ§** - äº†è§£åº”ç”¨è¿è¡ŒçŠ¶æ€
- ğŸ” **é—®é¢˜è¿½æº¯** - å¤ç°å’Œåˆ†æå†å²é—®é¢˜
- ğŸ“ˆ **æ€§èƒ½åˆ†æ** - è¯†åˆ«æ€§èƒ½ç“¶é¢ˆ
- ğŸ›¡ï¸ **å®‰å…¨å®¡è®¡** - è®°å½•å…³é”®æ“ä½œ

### 1.2 æŠ€æœ¯é€‰å‹

**ä¸ºä»€ä¹ˆé€‰æ‹©Qtå†…ç½®æ—¥å¿—ç³»ç»Ÿï¼Ÿ**

| å¯¹æ¯”é¡¹ | Qtå†…ç½®æ—¥å¿— | log4qt | spdlog |
|-------|-----------|--------|--------|
| **ä¾èµ–** | é›¶ä¾èµ– âœ… | éœ€è¦å¤–éƒ¨åº“ | éœ€è¦å¤–éƒ¨åº“ |
| **QMLé›†æˆ** | åŸç”Ÿæ”¯æŒ âœ… | éœ€è¦é€‚é… | éœ€è¦é€‚é… |
| **æ€§èƒ½** | ä¼˜ç§€ âœ… | è‰¯å¥½ | ä¼˜ç§€ |
| **å­¦ä¹ æ›²çº¿** | å¹³ç¼“ âœ… | é™¡å³­ | ä¸­ç­‰ |
| **ç»´æŠ¤æˆæœ¬** | æœ€ä½ âœ… | ä¸­ç­‰ | ä¸­ç­‰ |
| **é€‚ç”¨åœºæ™¯** | è½»é‡çº§åº”ç”¨ âœ… | ä¼ä¸šåº”ç”¨ | é«˜æ€§èƒ½åº”ç”¨ |

**ç»“è®ºï¼š** å¯¹äºK-memoè¿™ç§è½»é‡çº§æ¡Œé¢åº”ç”¨ï¼ŒQtå†…ç½®æ—¥å¿—ç³»ç»Ÿå®Œå…¨æ»¡è¶³éœ€æ±‚ã€‚

### 1.3 æ¶æ„è®¾è®¡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  åº”ç”¨å±‚ (C++ / QML)                     â”‚
â”‚  qDebug() / qInfo() / qWarning()       â”‚
â”‚  qCritical() / qFatal()                â”‚
â”‚  console.log() / console.warn()        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  LogManager (è‡ªå®šä¹‰æ—¥å¿—ç®¡ç†å™¨)         â”‚
â”‚  - æ¶ˆæ¯æ ¼å¼åŒ–                          â”‚
â”‚  - æ—¥å¿—åˆ†ç±»ï¼ˆCategoryï¼‰                â”‚
â”‚  - æ–‡ä»¶è¾“å‡º                            â”‚
â”‚  - çº§åˆ«è¿‡æ»¤                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Qtæ—¥å¿—ç³»ç»Ÿ                             â”‚
â”‚  qInstallMessageHandler()               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  è¾“å‡ºç›®æ ‡                               â”‚
â”‚  - æ§åˆ¶å° (stderr)                     â”‚
â”‚  - æ—¥å¿—æ–‡ä»¶ (data/logs/*.log)         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## äºŒã€è®¾è®¡æ–¹æ¡ˆ

### 2.1 æ ¸å¿ƒç‰¹æ€§

#### ç‰¹æ€§1ï¼šæ—¥å¿—çº§åˆ«ç®¡ç†

Qtæä¾›5ä¸ªæ—¥å¿—çº§åˆ«ï¼ˆä»ä½åˆ°é«˜ï¼‰ï¼š

| çº§åˆ« | å®å‡½æ•° | ç”¨é€” | ç”Ÿäº§ç¯å¢ƒ |
|-----|-------|------|----------|
| **Debug** | `qDebug()` | è¯¦ç»†è°ƒè¯•ä¿¡æ¯ | ç¦ç”¨ âŒ |
| **Info** | `qInfo()` | ä¸€èˆ¬ä¿¡æ¯ | å¯ç”¨ âœ… |
| **Warning** | `qWarning()` | è­¦å‘Šä¿¡æ¯ | å¯ç”¨ âœ… |
| **Critical** | `qCritical()` | ä¸¥é‡é”™è¯¯ | å¯ç”¨ âœ… |
| **Fatal** | `qFatal()` | è‡´å‘½é”™è¯¯ï¼ˆä¸­æ­¢ç¨‹åºï¼‰ | å¯ç”¨ âœ… |

#### ç‰¹æ€§2ï¼šæ—¥å¿—åˆ†ç±»ï¼ˆQLoggingCategoryï¼‰

ä½¿ç”¨åˆ†ç±»ç³»ç»Ÿç»„ç»‡æ—¥å¿—ï¼š

```cpp
Q_DECLARE_LOGGING_CATEGORY(lcDatabase)    // æ•°æ®åº“æ“ä½œ
Q_DECLARE_LOGGING_CATEGORY(lcModel)       // æ•°æ®æ¨¡å‹
Q_DECLARE_LOGGING_CATEGORY(lcUI)          // UIç›¸å…³
Q_DECLARE_LOGGING_CATEGORY(lcQml)         // QMLæ—¥å¿—
Q_DECLARE_LOGGING_CATEGORY(lcPerformance) // æ€§èƒ½ç›‘æ§
```

**ä¼˜åŠ¿ï¼š**
- âœ… æŒ‰æ¨¡å—åˆ†ç±»ï¼Œä¾¿äºè¿‡æ»¤
- âœ… å¯ä»¥ç‹¬ç«‹æ§åˆ¶æ¯ä¸ªåˆ†ç±»çš„å¯ç”¨/ç¦ç”¨
- âœ… ä¾¿äºå®šä½é—®é¢˜æ‰€åœ¨æ¨¡å—

#### ç‰¹æ€§3ï¼šç¯å¢ƒåŒºåˆ†

```cpp
#ifdef QT_DEBUG
    // å¼€å‘æ¨¡å¼ï¼šè¯¦ç»†æ—¥å¿— + æ§åˆ¶å°è¾“å‡º
    LogManager::instance()->setLogLevel(LogManager::Debug);
    LogManager::instance()->enableFileLogging(false);
#else
    // ç”Ÿäº§æ¨¡å¼ï¼šä»…è­¦å‘Šä»¥ä¸Š + æ–‡ä»¶è¾“å‡º
    LogManager::instance()->setLogLevel(LogManager::Warning);
    LogManager::instance()->enableFileLogging(true);
#endif
```

#### ç‰¹æ€§4ï¼šæ—¥å¿—æ ¼å¼åŒ–

**æ ‡å‡†è¾“å‡ºæ ¼å¼ï¼š**
```
[æ—¶é—´æˆ³] [çº§åˆ«] [åˆ†ç±»] [æ–‡ä»¶:è¡Œå·] æ¶ˆæ¯å†…å®¹
```

**ç¤ºä¾‹ï¼š**
```
[2025-10-25 14:30:15.123] [DEBUG] [kmemo.database] [databasemanager.cpp:145] Inserting task: abc123
[2025-10-25 14:30:15.156] [INFO ] [kmemo.model] [taskmodel.cpp:78] Task added. Total tasks: 15
[2025-10-25 14:30:15.201] [WARN ] [kmemo.qml] [Main.qml:42] Input validation failed
```

### 2.2 ç›®å½•ç»“æ„

```
k-memo/
â”œâ”€â”€ utils/                        # å·¥å…·ç±»ç›®å½• â­ æ–°å¢
â”‚   â”œâ”€â”€ logmanager.h             # æ—¥å¿—ç®¡ç†å™¨å¤´æ–‡ä»¶
â”‚   â””â”€â”€ logmanager.cpp           # æ—¥å¿—ç®¡ç†å™¨å®ç°
â”œâ”€â”€ data/
â”‚   â””â”€â”€ logs/                    # æ—¥å¿—æ–‡ä»¶ç›®å½•ï¼ˆè¿è¡Œæ—¶ç”Ÿæˆï¼‰
â”‚       â”œâ”€â”€ kmemo_20251025_143015.log
â”‚       â”œâ”€â”€ kmemo_20251025_150023.log
â”‚       â””â”€â”€ ...
â””â”€â”€ main.cpp                      # åˆå§‹åŒ–æ—¥å¿—ç³»ç»Ÿ
```

**é‡è¦è¯´æ˜ï¼š**
- `utils/` ç›®å½•å­˜æ”¾é€šç”¨å·¥å…·ç±»
- `data/logs/` åœ¨è¿è¡Œæ—¶è‡ªåŠ¨åˆ›å»º
- æ—¥å¿—æ–‡ä»¶æŒ‰å¯åŠ¨æ—¶é—´å‘½åï¼Œé¿å…è¦†ç›–

---

## ä¸‰ã€LogManagerå®ç°

### 3.1 å®Œæ•´ä»£ç 

è¯¦è§é™„å½•Aå’Œé™„å½•Bã€‚

### 3.2 æ ¸å¿ƒæ–¹æ³•è¯´æ˜

#### initialize()
```cpp
void LogManager::initialize(bool enableFileLogging = false);
```
**åŠŸèƒ½ï¼š** åˆå§‹åŒ–æ—¥å¿—ç³»ç»Ÿï¼Œå®‰è£…æ¶ˆæ¯å¤„ç†å™¨  
**å‚æ•°ï¼š** `enableFileLogging` - æ˜¯å¦å¯ç”¨æ–‡ä»¶è¾“å‡º  
**è°ƒç”¨æ—¶æœºï¼š** main()å‡½æ•°æœ€å¼€å§‹

#### setLogLevel()
```cpp
void LogManager::setLogLevel(LogLevel level);
```
**åŠŸèƒ½ï¼š** è®¾ç½®æœ€ä½æ—¥å¿—çº§åˆ«  
**å‚æ•°ï¼š** `Debug/Info/Warning/Critical`  
**è¯´æ˜ï¼š** ä½äºæ­¤çº§åˆ«çš„æ—¥å¿—å°†è¢«å¿½ç•¥

#### messageHandler()
```cpp
static void messageHandler(QtMsgType type, 
                           const QMessageLogContext &context, 
                           const QString &msg);
```
**åŠŸèƒ½ï¼š** Qtæ—¥å¿—ç³»ç»Ÿå›è°ƒå‡½æ•°  
**è¯´æ˜ï¼š** æ‰€æœ‰qDebug/qInfoç­‰è°ƒç”¨éƒ½ä¼šç»è¿‡æ­¤å‡½æ•°

---

## å››ã€ä½¿ç”¨æŒ‡å—

### 4.1 åˆå§‹åŒ–ï¼ˆmain.cppï¼‰

```cpp
#include "utils/logmanager.h"

int main(int argc, char *argv[]) {
    QGuiApplication app(argc, argv);
    
    // âœ… ç¬¬ä¸€æ­¥ï¼šåˆå§‹åŒ–æ—¥å¿—ç³»ç»Ÿ
#ifdef QT_DEBUG
    LogManager::instance()->initialize(false);  // å¼€å‘ï¼šä»…æ§åˆ¶å°
    LogManager::instance()->setLogLevel(LogManager::Debug);
#else
    LogManager::instance()->initialize(true);   // ç”Ÿäº§ï¼šè¾“å‡ºæ–‡ä»¶
    LogManager::instance()->setLogLevel(LogManager::Warning);
#endif
    
    qInfo() << "K-memo application starting...";
    
    // ... å…¶ä»–åˆå§‹åŒ–ä»£ç 
}
```

### 4.2 åœ¨C++ä»£ç ä¸­ä½¿ç”¨

#### åŸºæœ¬ç”¨æ³•

```cpp
#include "utils/logmanager.h"

void MyClass::someFunction() {
    qDebug() << "This is a debug message";
    qInfo() << "This is an info message";
    qWarning() << "This is a warning message";
    qCritical() << "This is a critical error";
}
```

#### ä½¿ç”¨æ—¥å¿—åˆ†ç±»

```cpp
#include "utils/logmanager.h"

// åœ¨DatabaseManagerä¸­
bool DatabaseManager::insertTask(const Task &task) {
    qCDebug(lcDatabase) << "Inserting task:" << task.id();
    
    QSqlQuery query;
    // ... æ‰§è¡ŒSQL
    
    if (!query.exec()) {
        qCCritical(lcDatabase) << "Failed to insert:" 
                               << query.lastError().text();
        return false;
    }
    
    qCInfo(lcDatabase) << "Task inserted successfully";
    return true;
}
```

#### æ¡ä»¶æ—¥å¿—

```cpp
// ä»…åœ¨æ»¡è¶³æ¡ä»¶æ—¶è¾“å‡º
if (task.priority() == TaskPriority::Urgent) {
    qCWarning(lcModel) << "Urgent task detected:" << task.title();
}

// ä½¿ç”¨æ ¼å¼åŒ–å­—ç¬¦ä¸²
qCInfo(lcPerformance) << QString("Query executed in %1 ms").arg(elapsed);
```

### 4.3 åœ¨QMLä¸­ä½¿ç”¨

QMLçš„consoleå¯¹è±¡è‡ªåŠ¨é›†æˆåˆ°Qtæ—¥å¿—ç³»ç»Ÿï¼š

```qml
// Main.qml
Button {
    onClicked: {
        console.log("Button clicked")       // â†’ qDebug()
        console.info("Info message")        // â†’ qInfo()
        console.warn("Warning message")     // â†’ qWarning()
        console.error("Error occurred")     // â†’ qCritical()
        
        // è¾“å‡ºå˜é‡
        console.log("Task count:", taskModel.getTaskCount())
        
        // è¾“å‡ºå¯¹è±¡
        console.log("Task:", JSON.stringify(task))
    }
}
```

**QMLæ—¥å¿—ç‰¹ç‚¹ï¼š**
- è‡ªåŠ¨æ ‡è®°ä¸º`lcQml`åˆ†ç±»
- åŒ…å«QMLæ–‡ä»¶åå’Œè¡Œå·
- æ”¯æŒå¤šä¸ªå‚æ•°è¾“å‡º

---

## äº”ã€é…ç½®è¯´æ˜

### 5.1 ç¼–è¯‘æ—¶é…ç½®

#### CMakeLists.txt

```cmake
# æ·»åŠ utilsç›®å½•åˆ°æ„å»º
set(PROJECT_SOURCES
    main.cpp
    
    # å·¥å…·ç±»
    utils/logmanager.h
    utils/logmanager.cpp
    
    # å…¶ä»–æºæ–‡ä»¶...
)

# å¼€å‘æ„å»ºï¼šå¯ç”¨è¯¦ç»†æ—¥å¿—
if(CMAKE_BUILD_TYPE STREQUAL "Debug")
    add_definitions(-DQT_DEBUG)
    add_definitions(-DQT_MESSAGELOGCONTEXT)  # å¯ç”¨æ–‡ä»¶åå’Œè¡Œå·
endif()
```

### 5.2 è¿è¡Œæ—¶é…ç½®

#### æ—¥å¿—çº§åˆ«æ§åˆ¶

```cpp
// åœ¨åº”ç”¨è¿è¡Œæ—¶åŠ¨æ€è°ƒæ•´
LogManager::instance()->setLogLevel(LogManager::Info);
```

#### åˆ†ç±»æ§åˆ¶

```cpp
// ç¦ç”¨ç‰¹å®šåˆ†ç±»
QLoggingCategory::setFilterRules("kmemo.performance=false");

// å¯ç”¨ç‰¹å®šåˆ†ç±»
QLoggingCategory::setFilterRules("kmemo.database.debug=true");

// å¤šä¸ªè§„åˆ™
QLoggingCategory::setFilterRules(
    "kmemo.*.debug=false\n"        // ç¦ç”¨æ‰€æœ‰Debug
    "kmemo.database.warning=true"  // å¯ç”¨æ•°æ®åº“Warning
);
```

### 5.3 æ—¥å¿—æ–‡ä»¶ç®¡ç†

#### æ—¥å¿—æ–‡ä»¶ä½ç½®

```cpp
// Windows: C:\Users\<ç”¨æˆ·å>\AppData\Local\K-memo\logs\
// Linux:   ~/.local/share/K-memo/logs/
// macOS:   ~/Library/Application Support/K-memo/logs/

QString logPath = QStandardPaths::writableLocation(
    QStandardPaths::AppDataLocation) + "/logs";
```

#### æ—¥å¿—æ–‡ä»¶å‘½å

```
kmemo_YYYYMMDD_HHMMSS.log
ç¤ºä¾‹ï¼škmemo_20251025_143015.log
```

#### æ—¥å¿—æ¸…ç†ç­–ç•¥ï¼ˆå¯é€‰ï¼‰

```cpp
// LogManagerä¸­æ·»åŠ æ¸…ç†æ—§æ—¥å¿—çš„æ–¹æ³•
void LogManager::cleanOldLogs(int keepDays = 7) {
    QDir logDir(m_logPath);
    QFileInfoList files = logDir.entryInfoList(
        QStringList() << "kmemo_*.log",
        QDir::Files,
        QDir::Time | QDir::Reversed
    );
    
    QDateTime threshold = QDateTime::currentDateTime()
                            .addDays(-keepDays);
    
    for (const QFileInfo &file : files) {
        if (file.lastModified() < threshold) {
            QFile::remove(file.absoluteFilePath());
        }
    }
}
```

---

## å…­ã€æœ€ä½³å®è·µ

### 6.1 æ—¥å¿—çº§åˆ«ä½¿ç”¨å‡†åˆ™

| çº§åˆ« | ä½¿ç”¨åœºæ™¯ | ç¤ºä¾‹ |
|-----|---------|------|
| **Debug** | å‡½æ•°è¿›å…¥/é€€å‡ºã€å˜é‡å€¼ã€å¾ªç¯è®¡æ•° | `qCDebug(lcModel) << "Processing task" << taskId;` |
| **Info** | å…³é”®æ“ä½œå®Œæˆã€çŠ¶æ€å˜æ›´ | `qCInfo(lcDatabase) << "Database initialized";` |
| **Warning** | å¯æ¢å¤çš„é”™è¯¯ã€ä¸å½±å“ä¸»æµç¨‹ | `qCWarning(lcUI) << "Invalid input, using default";` |
| **Critical** | ä¸¥é‡é”™è¯¯ã€å½±å“åŠŸèƒ½ | `qCCritical(lcDatabase) << "Failed to connect";` |
| **Fatal** | è‡´å‘½é”™è¯¯ã€ç¨‹åºæ— æ³•ç»§ç»­ | `qFatal("Configuration file missing");` |

### 6.2 æ—¥å¿—å†…å®¹å‡†åˆ™

**âœ… å¥½çš„æ—¥å¿—ï¼š**
```cpp
// åŒ…å«ä¸Šä¸‹æ–‡ä¿¡æ¯
qCInfo(lcDatabase) << "Task inserted successfully. ID:" << task.id() 
                   << "Title:" << task.title();

// åŒ…å«æ“ä½œç»“æœ
qCDebug(lcModel) << "Task list filtered. Before:" << beforeCount 
                 << "After:" << afterCount;

// åŒ…å«é”™è¯¯è¯¦æƒ…
qCCritical(lcDatabase) << "SQL error:" << query.lastError().text() 
                       << "Query:" << query.lastQuery();
```

**âŒ ä¸å¥½çš„æ—¥å¿—ï¼š**
```cpp
// ä¿¡æ¯ä¸è¶³
qDebug() << "Error";  // ä»€ä¹ˆé”™è¯¯ï¼Ÿ

// è¿‡äºå†—é•¿
qDebug() << "Very very very long message with tons of details...";

// åŒ…å«æ•æ„Ÿä¿¡æ¯
qDebug() << "Password:" << password;  // âš ï¸ å®‰å…¨é—®é¢˜ï¼
```

### 6.3 æ€§èƒ½æ•æ„Ÿä»£ç 

```cpp
// âŒ é”™è¯¯ï¼šå³ä½¿ä¸è¾“å‡ºä¹Ÿä¼šæ‰§è¡Œå­—ç¬¦ä¸²æ‹¼æ¥
qCDebug(lcPerformance) << "Task:" << task.toJson().toStdString();

// âœ… æ­£ç¡®ï¼šä½¿ç”¨æ¡ä»¶åˆ¤æ–­
if (lcPerformance().isDebugEnabled()) {
    qCDebug(lcPerformance) << "Task:" << task.toJson();
}

// âœ… æ›´å¥½ï¼šä½¿ç”¨å®ï¼ˆå¦‚æœæ—¥å¿—è¢«ç¦ç”¨ï¼Œæ•´ä¸ªè¡¨è¾¾å¼ä¸ä¼šç¼–è¯‘ï¼‰
#ifdef QT_DEBUG
    qCDebug(lcPerformance) << "Expensive operation:" << calculateStats();
#endif
```

---

## ä¸ƒã€æ€§èƒ½è€ƒè™‘

### 7.1 æ€§èƒ½å¼€é”€åˆ†æ

| æ“ä½œ | å¼€é”€ | è¯´æ˜ |
|-----|------|------|
| qDebug()è°ƒç”¨ | æä½ | å¦‚æœçº§åˆ«è¢«è¿‡æ»¤ï¼Œå‡ ä¹æ— å¼€é”€ |
| å­—ç¬¦ä¸²æ ¼å¼åŒ– | ä½ | ä»…åœ¨å®é™…è¾“å‡ºæ—¶æ‰§è¡Œ |
| æ–‡ä»¶å†™å…¥ | ä¸­ | ä½¿ç”¨ç¼“å†²åŒºï¼Œæ‰¹é‡å†™å…¥ |
| é”ç«äº‰ | æä½ | QMutexä¿æŠ¤ï¼Œä½†æŒæœ‰æ—¶é—´æçŸ­ |

### 7.2 ä¼˜åŒ–å»ºè®®

#### 1. é¿å…é¢‘ç¹æ—¥å¿—

```cpp
// âŒ ä¸è¦åœ¨å¾ªç¯ä¸­å¤§é‡è¾“å‡º
for (const Task &task : tasks) {
    qDebug() << "Processing" << task.id();  // 1000æ¬¡å¾ªç¯ = 1000è¡Œæ—¥å¿—
}

// âœ… åº”è¯¥ï¼šæ±‡æ€»è¾“å‡º
qDebug() << "Processing" << tasks.size() << "tasks";
```

#### 2. ä½¿ç”¨åˆé€‚çš„æ—¥å¿—çº§åˆ«

```cpp
// âŒ ä¸è¦æ»¥ç”¨Warning/Critical
qCWarning(lcModel) << "Task count is" << count;  // è¿™åªæ˜¯Infoçº§åˆ«

// âœ… åº”è¯¥
qCInfo(lcModel) << "Task count is" << count;
```

#### 3. ç”Ÿäº§ç¯å¢ƒä¼˜åŒ–

```cpp
// ç”Ÿäº§ç¯å¢ƒç¦ç”¨Debugæ—¥å¿—
#ifndef QT_DEBUG
    // Debugæ—¥å¿—å®Œå…¨ä¸ç¼–è¯‘
    #define qCDebug(category) QNoDebug()
#endif
```

---

## å…«ã€æ•…éšœæ’æŸ¥

### 8.1 å¸¸è§é—®é¢˜

#### é—®é¢˜1ï¼šæ—¥å¿—æ²¡æœ‰è¾“å‡º

**å¯èƒ½åŸå› ï¼š**
- æ—¥å¿—çº§åˆ«è®¾ç½®è¿‡é«˜
- æ—¥å¿—åˆ†ç±»è¢«ç¦ç”¨
- æ²¡æœ‰è°ƒç”¨`initialize()`

**è§£å†³æ–¹æ³•ï¼š**
```cpp
// æ£€æŸ¥åˆå§‹åŒ–
qInfo() << "Test log output";  // å¦‚æœè¿™æ¡èƒ½æ˜¾ç¤ºï¼Œè¯´æ˜ç³»ç»Ÿæ­£å¸¸

// æ£€æŸ¥çº§åˆ«
LogManager::instance()->setLogLevel(LogManager::Debug);

// æ£€æŸ¥åˆ†ç±»
QLoggingCategory::setFilterRules("*.debug=true");
```

#### é—®é¢˜2ï¼šæ—¥å¿—æ–‡ä»¶ä¸ºç©º

**å¯èƒ½åŸå› ï¼š**
- æ–‡ä»¶è·¯å¾„æ²¡æœ‰å†™æƒé™
- ç¨‹åºå¼‚å¸¸é€€å‡ºï¼Œç¼“å†²åŒºæœªåˆ·æ–°

**è§£å†³æ–¹æ³•ï¼š**
```cpp
// åœ¨LogManagerææ„å‡½æ•°ä¸­ç¡®ä¿åˆ·æ–°
LogManager::~LogManager() {
    if (m_logFile.isOpen()) {
        m_logStream.flush();  // âœ… å¼ºåˆ¶åˆ·æ–°
        m_logFile.close();
    }
}
```

#### é—®é¢˜3ï¼šQMLæ—¥å¿—ä¸æ˜¾ç¤º

**è§£å†³æ–¹æ³•ï¼š**
```cpp
// ç¡®ä¿QMLæ—¥å¿—åˆ†ç±»å·²å¯ç”¨
Q_LOGGING_CATEGORY(lcQml, "kmemo.qml", QtDebugMsg);  // é»˜è®¤å¯ç”¨Debug
```

### 8.2 è°ƒè¯•æŠ€å·§

#### æŠ€å·§1ï¼šä¸´æ—¶å¯ç”¨è¯¦ç»†æ—¥å¿—

```bash
# Windowsç¯å¢ƒå˜é‡
set QT_LOGGING_RULES="*.debug=true"
k-memo.exe

# Linux/Macç¯å¢ƒå˜é‡
QT_LOGGING_RULES="*.debug=true" ./k-memo
```

#### æŠ€å·§2ï¼šæŸ¥çœ‹ç‰¹å®šæ¨¡å—æ—¥å¿—

```bash
# ä»…æŸ¥çœ‹æ•°æ®åº“æ—¥å¿—
QT_LOGGING_RULES="kmemo.database.*=true;*=false" ./k-memo
```

#### æŠ€å·§3ï¼šé‡å®šå‘æ—¥å¿—åˆ°æ–‡ä»¶

```bash
# Windows PowerShell
.\k-memo.exe 2>&1 | Tee-Object -FilePath debug.log

# Linux/Mac
./k-memo 2>&1 | tee debug.log
```

---

## é™„å½•Aï¼šlogmanager.hå®Œæ•´ä»£ç 

```cpp
#ifndef LOGMANAGER_H
#define LOGMANAGER_H

#include <QObject>
#include <QFile>
#include <QTextStream>
#include <QDateTime>
#include <QMutex>
#include <QLoggingCategory>

/**
 * @brief LogManager - K-memoæ—¥å¿—ç®¡ç†å™¨
 * 
 * åŸºäºQtå†…ç½®æ—¥å¿—ç³»ç»Ÿçš„è½»é‡çº§æ—¥å¿—ç®¡ç†å™¨
 * æä¾›æ—¥å¿—åˆ†ç±»ã€çº§åˆ«è¿‡æ»¤ã€æ–‡ä»¶è¾“å‡ºç­‰åŠŸèƒ½
 * 
 * @author K-memo Team
 * @date 2025-10-25
 */
class LogManager : public QObject {
    Q_OBJECT
    
public:
    /**
     * @brief è·å–å•ä¾‹å®ä¾‹
     * @return LogManager* å…¨å±€å”¯ä¸€å®ä¾‹
     */
    static LogManager* instance();
    
    /**
     * @brief åˆå§‹åŒ–æ—¥å¿—ç³»ç»Ÿ
     * @param enableFileLogging æ˜¯å¦å¯ç”¨æ–‡ä»¶è¾“å‡º
     * 
     * âš ï¸ å¿…é¡»åœ¨main()å‡½æ•°æœ€å¼€å§‹è°ƒç”¨
     */
    void initialize(bool enableFileLogging = false);
    
    /**
     * @brief æ—¥å¿—çº§åˆ«æšä¸¾
     */
    enum LogLevel {
        Debug,      // è¯¦ç»†è°ƒè¯•ä¿¡æ¯
        Info,       // ä¸€èˆ¬ä¿¡æ¯
        Warning,    // è­¦å‘Šä¿¡æ¯
        Critical    // ä¸¥é‡é”™è¯¯
    };
    Q_ENUM(LogLevel)
    
    /**
     * @brief è®¾ç½®æœ€ä½æ—¥å¿—çº§åˆ«
     * @param level æ—¥å¿—çº§åˆ«
     * 
     * ä½äºæ­¤çº§åˆ«çš„æ—¥å¿—å°†è¢«å¿½ç•¥
     */
    void setLogLevel(LogLevel level);
    
    /**
     * @brief è®¾ç½®æ—¥å¿—æ–‡ä»¶è·¯å¾„
     * @param path æ—¥å¿—æ–‡ä»¶å®Œæ•´è·¯å¾„
     */
    void setLogFilePath(const QString &path);
    
    /**
     * @brief å¯ç”¨/ç¦ç”¨æ–‡ä»¶æ—¥å¿—
     * @param enabled æ˜¯å¦å¯ç”¨
     */
    void enableFileLogging(bool enabled);
    
    /**
     * @brief Qtæ¶ˆæ¯å¤„ç†å›è°ƒå‡½æ•°
     * 
     * é€šè¿‡qInstallMessageHandler()å®‰è£…
     */
    static void messageHandler(QtMsgType type,
                               const QMessageLogContext &context,
                               const QString &msg);
    
private:
    explicit LogManager(QObject *parent = nullptr);
    ~LogManager();
    
    // ç¦æ­¢æ‹·è´å’Œèµ‹å€¼
    Q_DISABLE_COPY(LogManager)
    
    /**
     * @brief æ ¼å¼åŒ–æ—¥å¿—æ¶ˆæ¯
     * @param type æ¶ˆæ¯ç±»å‹
     * @param context æ¶ˆæ¯ä¸Šä¸‹æ–‡ï¼ˆæ–‡ä»¶ã€è¡Œå·ç­‰ï¼‰
     * @param msg åŸå§‹æ¶ˆæ¯
     * @return æ ¼å¼åŒ–åçš„æ¶ˆæ¯å­—ç¬¦ä¸²
     */
    QString formatMessage(QtMsgType type,
                         const QMessageLogContext &context,
                         const QString &msg);
    
    /**
     * @brief å°†QtMsgTypeè½¬æ¢ä¸ºå­—ç¬¦ä¸²
     */
    QString msgTypeToString(QtMsgType type) const;
    
    /**
     * @brief æ£€æŸ¥æ¶ˆæ¯æ˜¯å¦åº”è¯¥è¾“å‡º
     */
    bool shouldLog(QtMsgType type) const;
    
    static LogManager *s_instance;      // å•ä¾‹å®ä¾‹
    QFile m_logFile;                     // æ—¥å¿—æ–‡ä»¶
    QTextStream m_logStream;             // æ–‡ä»¶è¾“å‡ºæµ
    QMutex m_mutex;                      // çº¿ç¨‹å®‰å…¨é”
    LogLevel m_logLevel;                 // æœ€ä½æ—¥å¿—çº§åˆ«
    bool m_fileLoggingEnabled;           // æ˜¯å¦å¯ç”¨æ–‡ä»¶è¾“å‡º
    QString m_logFilePath;               // æ—¥å¿—æ–‡ä»¶è·¯å¾„
};

// ========================================
// æ—¥å¿—åˆ†ç±»å®šä¹‰
// ========================================

/**
 * @brief æ•°æ®åº“æ“ä½œæ—¥å¿—
 * ç”¨äºDatabaseManagerä¸­çš„SQLæ‰§è¡Œã€è¿æ¥ç®¡ç†ç­‰
 */
Q_DECLARE_LOGGING_CATEGORY(lcDatabase)

/**
 * @brief æ•°æ®æ¨¡å‹æ—¥å¿—
 * ç”¨äºTaskModelã€Taskç­‰æ•°æ®æ¨¡å‹æ“ä½œ
 */
Q_DECLARE_LOGGING_CATEGORY(lcModel)

/**
 * @brief UIç›¸å…³æ—¥å¿—
 * ç”¨äºC++ä¾§çš„UIç»„ä»¶ã€äº‹ä»¶å¤„ç†ç­‰
 */
Q_DECLARE_LOGGING_CATEGORY(lcUI)

/**
 * @brief æ€§èƒ½ç›‘æ§æ—¥å¿—
 * ç”¨äºæ€§èƒ½åˆ†æã€è€—æ—¶ç»Ÿè®¡ç­‰
 */
Q_DECLARE_LOGGING_CATEGORY(lcPerformance)

/**
 * @brief QMLæ—¥å¿—
 * ç”¨äºQMLä¾§çš„console.logç­‰è¾“å‡º
 */
Q_DECLARE_LOGGING_CATEGORY(lcQml)

#endif // LOGMANAGER_H
```

---

## é™„å½•Bï¼šlogmanager.cppå®Œæ•´ä»£ç 

```cpp
#include "logmanager.h"
#include <QStandardPaths>
#include <QDir>
#include <QDebug>

// ========================================
// å®šä¹‰æ—¥å¿—åˆ†ç±»
// ========================================
Q_LOGGING_CATEGORY(lcDatabase, "kmemo.database")
Q_LOGGING_CATEGORY(lcModel, "kmemo.model")
Q_LOGGING_CATEGORY(lcUI, "kmemo.ui")
Q_LOGGING_CATEGORY(lcPerformance, "kmemo.performance")
Q_LOGGING_CATEGORY(lcQml, "kmemo.qml")

// ========================================
// é™æ€æˆå‘˜åˆå§‹åŒ–
// ========================================
LogManager* LogManager::s_instance = nullptr;

// ========================================
// å…¬å…±æ–¹æ³•å®ç°
// ========================================

LogManager* LogManager::instance() {
    if (!s_instance) {
        s_instance = new LogManager();
    }
    return s_instance;
}

void LogManager::initialize(bool enableFileLogging) {
    m_fileLoggingEnabled = enableFileLogging;
    
    // å¦‚æœå¯ç”¨æ–‡ä»¶æ—¥å¿—ï¼Œåˆ›å»ºæ—¥å¿—æ–‡ä»¶
    if (m_fileLoggingEnabled) {
        // è·å–æ—¥å¿—ç›®å½•ï¼šAppDataLocation/logs/
        QString logDir = QStandardPaths::writableLocation(
            QStandardPaths::AppDataLocation) + "/logs";
        
        // åˆ›å»ºç›®å½•ï¼ˆå¦‚æœä¸å­˜åœ¨ï¼‰
        QDir dir;
        if (!dir.exists(logDir)) {
            dir.mkpath(logDir);
        }
        
        // ç”Ÿæˆæ—¥å¿—æ–‡ä»¶åï¼škmemo_YYYYMMDD_HHMMSS.log
        QString timestamp = QDateTime::currentDateTime()
                            .toString("yyyyMMdd_HHmmss");
        m_logFilePath = QString("%1/kmemo_%2.log")
                        .arg(logDir)
                        .arg(timestamp);
        
        // æ‰“å¼€æ—¥å¿—æ–‡ä»¶
        m_logFile.setFileName(m_logFilePath);
        if (m_logFile.open(QIODevice::WriteOnly | QIODevice::Text)) {
            m_logStream.setDevice(&m_logFile);
            
            // å†™å…¥æ–‡ä»¶å¤´
            m_logStream << "========================================\n";
            m_logStream << "K-memo Application Log\n";
            m_logStream << "Start Time: " << QDateTime::currentDateTime()
                                            .toString("yyyy-MM-dd HH:mm:ss") << "\n";
            m_logStream << "========================================\n";
            m_logStream.flush();
            
            qInfo() << "Log file created:" << m_logFilePath;
        } else {
            qWarning() << "Failed to create log file:" << m_logFilePath;
        }
    }
    
    // å®‰è£…æ¶ˆæ¯å¤„ç†å™¨
    qInstallMessageHandler(LogManager::messageHandler);
    
    qInfo() << "LogManager initialized. File logging:" 
            << (m_fileLoggingEnabled ? "enabled" : "disabled");
}

void LogManager::setLogLevel(LogLevel level) {
    m_logLevel = level;
    qInfo() << "Log level set to:" << level;
}

void LogManager::setLogFilePath(const QString &path) {
    QMutexLocker locker(&m_mutex);
    
    // å…³é—­æ—§æ–‡ä»¶
    if (m_logFile.isOpen()) {
        m_logStream.flush();
        m_logFile.close();
    }
    
    // æ‰“å¼€æ–°æ–‡ä»¶
    m_logFilePath = path;
    m_logFile.setFileName(path);
    if (m_logFile.open(QIODevice::WriteOnly | QIODevice::Text)) {
        m_logStream.setDevice(&m_logFile);
        qInfo() << "Log file changed to:" << path;
    } else {
        qWarning() << "Failed to open new log file:" << path;
    }
}

void LogManager::enableFileLogging(bool enabled) {
    m_fileLoggingEnabled = enabled;
    
    if (!enabled && m_logFile.isOpen()) {
        QMutexLocker locker(&m_mutex);
        m_logStream.flush();
        m_logFile.close();
        qInfo() << "File logging disabled";
    } else if (enabled && !m_logFile.isOpen()) {
        initialize(true);
    }
}

void LogManager::messageHandler(QtMsgType type,
                                const QMessageLogContext &context,
                                const QString &msg) {
    LogManager *manager = LogManager::instance();
    
    // æ£€æŸ¥æ˜¯å¦åº”è¯¥è¾“å‡º
    if (!manager->shouldLog(type)) {
        return;
    }
    
    // æ ¼å¼åŒ–æ¶ˆæ¯
    QString formattedMsg = manager->formatMessage(type, context, msg);
    
    // è¾“å‡ºåˆ°æ§åˆ¶å°
    fprintf(stderr, "%s\n", formattedMsg.toLocal8Bit().constData());
    
    // è¾“å‡ºåˆ°æ–‡ä»¶
    if (manager->m_fileLoggingEnabled && manager->m_logFile.isOpen()) {
        QMutexLocker locker(&manager->m_mutex);
        manager->m_logStream << formattedMsg << "\n";
        manager->m_logStream.flush();  // ç«‹å³åˆ·æ–°ï¼Œé˜²æ­¢å¼‚å¸¸é€€å‡ºä¸¢å¤±æ—¥å¿—
    }
    
    // Fatalæ¶ˆæ¯ï¼šä¸­æ­¢ç¨‹åº
    if (type == QtFatalMsg) {
        abort();
    }
}

// ========================================
// ç§æœ‰æ–¹æ³•å®ç°
// ========================================

LogManager::LogManager(QObject *parent)
    : QObject(parent)
    , m_logLevel(Debug)  // é»˜è®¤Debugçº§åˆ«
    , m_fileLoggingEnabled(false)
{
}

LogManager::~LogManager() {
    // ç¡®ä¿æ‰€æœ‰æ—¥å¿—éƒ½è¢«å†™å…¥
    if (m_logFile.isOpen()) {
        QMutexLocker locker(&m_mutex);
        m_logStream << "\n========================================\n";
        m_logStream << "End Time: " << QDateTime::currentDateTime()
                                      .toString("yyyy-MM-dd HH:mm:ss") << "\n";
        m_logStream << "========================================\n";
        m_logStream.flush();
        m_logFile.close();
    }
}

QString LogManager::formatMessage(QtMsgType type,
                                  const QMessageLogContext &context,
                                  const QString &msg) {
    // æ ¼å¼ï¼š[æ—¶é—´æˆ³] [çº§åˆ«] [åˆ†ç±»] [æ–‡ä»¶:è¡Œå·] æ¶ˆæ¯
    QString timestamp = QDateTime::currentDateTime()
                        .toString("yyyy-MM-dd HH:mm:ss.zzz");
    
    QString typeStr = msgTypeToString(type);
    
    // æå–åˆ†ç±»åç§°ï¼ˆå¦‚æœæœ‰ï¼‰
    QString category;
    if (context.category && QString(context.category) != "default") {
        category = QString("[%1]").arg(context.category);
    }
    
    // æå–æ–‡ä»¶åå’Œè¡Œå·ï¼ˆä»…åœ¨Debugæ„å»ºä¸­ï¼‰
    QString location;
#ifdef QT_MESSAGELOGCONTEXT
    if (context.file) {
        // ä»…æ˜¾ç¤ºæ–‡ä»¶åï¼Œä¸æ˜¾ç¤ºå®Œæ•´è·¯å¾„
        QString fileName = QString(context.file).split('/').last()
                                                 .split('\\').last();
        location = QString("[%1:%2]").arg(fileName).arg(context.line);
    }
#endif
    
    // ç»„è£…æœ€ç»ˆæ¶ˆæ¯
    return QString("[%1] [%2] %3 %4 %5")
           .arg(timestamp)
           .arg(typeStr, -8)  // å·¦å¯¹é½ï¼Œå®½åº¦8
           .arg(category, -20) // å·¦å¯¹é½ï¼Œå®½åº¦20
           .arg(location, -30) // å·¦å¯¹é½ï¼Œå®½åº¦30
           .arg(msg);
}

QString LogManager::msgTypeToString(QtMsgType type) const {
    switch (type) {
        case QtDebugMsg:    return "DEBUG";
        case QtInfoMsg:     return "INFO";
        case QtWarningMsg:  return "WARNING";
        case QtCriticalMsg: return "CRITICAL";
        case QtFatalMsg:    return "FATAL";
        default:            return "UNKNOWN";
    }
}

bool LogManager::shouldLog(QtMsgType type) const {
    // å°†QtMsgTypeæ˜ å°„åˆ°LogLevel
    int msgLevel = 0;
    switch (type) {
        case QtDebugMsg:    msgLevel = Debug; break;
        case QtInfoMsg:     msgLevel = Info; break;
        case QtWarningMsg:  msgLevel = Warning; break;
        case QtCriticalMsg:
        case QtFatalMsg:    msgLevel = Critical; break;
    }
    
    // åªè¾“å‡ºå¤§äºç­‰äºè®¾å®šçº§åˆ«çš„æ¶ˆæ¯
    return msgLevel >= m_logLevel;
}
```

---

## é™„å½•Cï¼šmain.cppé›†æˆç¤ºä¾‹

```cpp
#include <QGuiApplication>
#include <QQmlApplicationEngine>
#include <QQmlContext>
#include "utils/logmanager.h"
#include "models/taskmodel.h"
#include "database/databasemanager.h"
#include "managers/traymanager.h"
#include "managers/notificationmanager.h"

int main(int argc, char *argv[]) {
    QGuiApplication app(argc, argv);
    
    // ========================================
    // âœ… ç¬¬ä¸€æ­¥ï¼šåˆå§‹åŒ–æ—¥å¿—ç³»ç»Ÿ
    // ========================================
#ifdef QT_DEBUG
    // å¼€å‘æ¨¡å¼ï¼šä»…æ§åˆ¶å°è¾“å‡ºï¼ŒDebugçº§åˆ«
    LogManager::instance()->initialize(false);
    LogManager::instance()->setLogLevel(LogManager::Debug);
    
    qInfo() << "Running in DEBUG mode";
#else
    // ç”Ÿäº§æ¨¡å¼ï¼šè¾“å‡ºåˆ°æ–‡ä»¶ï¼ŒWarningçº§åˆ«
    LogManager::instance()->initialize(true);
    LogManager::instance()->setLogLevel(LogManager::Warning);
    
    qInfo() << "Running in RELEASE mode";
#endif
    
    qInfo() << "K-memo application starting...";
    
    // ========================================
    // ç¬¬äºŒæ­¥ï¼šåˆå§‹åŒ–æ•°æ®åº“
    // ========================================
    qCInfo(lcDatabase) << "Initializing database...";
    DatabaseManager *db = DatabaseManager::instance();
    if (!db) {
        qCCritical(lcDatabase) << "Failed to initialize database!";
        return -1;
    }
    qCInfo(lcDatabase) << "Database initialized successfully";
    
    // ========================================
    // ç¬¬ä¸‰æ­¥ï¼šåˆ›å»ºæ•°æ®æ¨¡å‹
    // ========================================
    qCInfo(lcModel) << "Creating TaskModel...";
    TaskModel taskModel;
    qCInfo(lcModel) << "TaskModel created. Task count:" 
                    << taskModel.getTaskCount();
    
    // ========================================
    // ç¬¬å››æ­¥ï¼šåˆå§‹åŒ–QMLå¼•æ“
    // ========================================
    qCInfo(lcUI) << "Initializing QML engine...";
    QQmlApplicationEngine engine;
    
    // æ³¨å†ŒTaskModelåˆ°QMLä¸Šä¸‹æ–‡
    engine.rootContext()->setContextProperty("taskModel", &taskModel);
    
    // åŠ è½½ä¸»QMLæ–‡ä»¶
    const QUrl url(u"qrc:/qml/Main.qml"_qs);
    engine.load(url);
    
    if (engine.rootObjects().isEmpty()) {
        qCCritical(lcQml) << "Failed to load QML!";
        return -1;
    }
    
    qCInfo(lcUI) << "QML loaded successfully";
    
    // ========================================
    // ç¬¬äº”æ­¥ï¼šå¯åŠ¨åº”ç”¨ç¨‹åº
    // ========================================
    qInfo() << "Application started. Entering event loop...";
    int result = app.exec();
    
    qInfo() << "Application exiting with code:" << result;
    return result;
}
```

---

## é™„å½•Dï¼šCMakeLists.txté…ç½®ç¤ºä¾‹

```cmake
cmake_minimum_required(VERSION 3.16)
project(k-memo VERSION 1.0 LANGUAGES CXX)

set(CMAKE_CXX_STANDARD 17)
set(CMAKE_CXX_STANDARD_REQUIRED ON)

# Qté…ç½®
set(CMAKE_AUTOMOC ON)
set(CMAKE_AUTOUIC ON)
set(CMAKE_AUTORCC ON)

# æŸ¥æ‰¾Qtæ¨¡å—
find_package(Qt6 REQUIRED COMPONENTS
    Core
    Quick
    Qml
    QuickControls2
    Sql
)

# æºæ–‡ä»¶åˆ—è¡¨
set(PROJECT_SOURCES
    main.cpp
    
    # â­ å·¥å…·ç±»ï¼ˆæ–°å¢ï¼‰
    utils/logmanager.h
    utils/logmanager.cpp
    
    # æ•°æ®æ¨¡å‹
    models/task.h
    models/task.cpp
    models/taskmodel.h
    models/taskmodel.cpp
    
    # æ•°æ®åº“
    database/databasemanager.h
    database/databasemanager.cpp
    
    # ç®¡ç†å™¨
    managers/traymanager.h
    managers/traymanager.cpp
    managers/notificationmanager.h
    managers/notificationmanager.cpp
    
    # èµ„æºæ–‡ä»¶
    resources.qrc
)

# QMLæ–‡ä»¶ï¼ˆå¯é€‰ï¼Œç”¨äºIDEè¯†åˆ«ï¼‰
set(QML_FILES
    qml/Main.qml
    qml/components/cards/StatsCard.qml
    qml/components/cards/AddTaskCard.qml
    qml/components/cards/TaskListCard.qml
    qml/components/items/TaskItem.qml
)

# åˆ›å»ºå¯æ‰§è¡Œæ–‡ä»¶
qt_add_executable(k-memo
    ${PROJECT_SOURCES}
)

# QMLæ¨¡å—ï¼ˆQt6.2+ï¼‰
qt_add_qml_module(k-memo
    URI KMemo
    VERSION 1.0
    QML_FILES ${QML_FILES}
)

# é“¾æ¥Qtåº“
target_link_libraries(k-memo PRIVATE
    Qt6::Core
    Qt6::Quick
    Qt6::Qml
    Qt6::QuickControls2
    Qt6::Sql
)

# â­ Debugæ„å»ºï¼šå¯ç”¨æ¶ˆæ¯ä¸Šä¸‹æ–‡
if(CMAKE_BUILD_TYPE STREQUAL "Debug")
    add_definitions(-DQT_MESSAGELOGCONTEXT)  # å¯ç”¨æ–‡ä»¶åå’Œè¡Œå·
    message(STATUS "Debug build: QT_MESSAGELOGCONTEXT enabled")
endif()

# å®‰è£…é…ç½®
install(TARGETS k-memo
    BUNDLE DESTINATION .
    RUNTIME DESTINATION ${CMAKE_INSTALL_BINDIR}
)
```

---

**æ–‡æ¡£ç‰ˆæœ¬ï¼š** v1.0  
**æœ€åæ›´æ–°ï¼š** 2025-10-25  
**ç»´æŠ¤äººå‘˜ï¼š** K-memoå¼€å‘å›¢é˜Ÿ  
**ç›¸å…³æ–‡æ¡£ï¼š**
- `[101]Qt Quické‡æ„æŠ€æœ¯æ–¹æ¡ˆ.md` - UIé‡æ„æ€»ä½“æ–¹æ¡ˆ
- `[003]æ•°æ®åº“è®¾è®¡æ–‡æ¡£.md` - æ•°æ®åº“æ¶æ„
- `CLAUDE.md` - é¡¹ç›®å¼€å‘æŒ‡å—

**å®ŒæˆçŠ¶æ€ï¼š** âœ… æ–‡æ¡£ç¼–å†™å®Œæˆ

---

## æ–‡æ¡£å˜æ›´è®°å½•

| ç‰ˆæœ¬ | æ—¥æœŸ | å˜æ›´è¯´æ˜ |
|-----|------|---------|
| v1.0 | 2025-10-25 | åˆå§‹ç‰ˆæœ¬ï¼Œå®Œæ•´çš„æ—¥å¿—ç³»ç»Ÿè®¾è®¡å’Œå®ç° |

